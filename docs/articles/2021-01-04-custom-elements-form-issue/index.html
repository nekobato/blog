<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Web ComponentsでInputを扱う方法 - nekobatoken</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="twitter:card" neme="twitter:card" content="summary_large_image"><meta data-n-head="ssr" data-hid="description" name="description" content="nekobato blog"><meta data-n-head="ssr" data-hid="og:site_name" property="og:site_name" content="nekobatoken"><meta data-n-head="ssr" data-hid="og:type" property="og:type" content="website"><meta data-n-head="ssr" data-hid="og:url" property="og:url" content="https://blog.nekobato.net/articles/2021-01-04-custom-elements-form-issue"><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Web ComponentsでInputを扱う方法 - nekobatoken"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="問題
Custom Elements(Web Components)の中でinputを使うと色々問題がある"><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://blog.nekobato.net/image.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/ecea5ae.js" as="script"><link rel="preload" href="/_nuxt/95985e6.js" as="script"><link rel="preload" href="/_nuxt/8645003.js" as="script"><link rel="preload" href="/_nuxt/8bb19f3.js" as="script"><link rel="preload" href="/_nuxt/c3ba0e7.js" as="script"><style data-vue-ssr-id="7b3488d6:0 0623093e:0 fa7ff0ca:0 56b15182:0 bf543d92:0 15cb4b13:0 0635541c:0 7c20a30e:0">*,:after,:before{box-sizing:border-box}ol[class],ul[class]{padding:0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,ol[class],p,ul[class]{margin:0}html{scroll-behavior:smooth}body{min-height:100vh;text-rendering:optimizeSpeed;font-family:"Helvetica Neue",Arial,"Hiragino Kaku Gothic ProN","Hiragino Sans",Meiryo,sans-serif;color:#222;background-color:#fff;font-size:14px;font-weight:400;line-height:1.5em;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}ol[class],ul[class]{list-style:none}a:not([class]){-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto}button,input,select,textarea{font:inherit}@media (prefers-reduced-motion:reduce){*{-webkit-animation-duration:NaNs!important;animation-duration:NaNs!important;-webkit-animation-iteration-count:1!important;animation-iteration-count:1!important;transition-duration:NaNs!important;scroll-behavior:auto!important}}body{background-image:linear-gradient(90deg,rgba(0,0,0,.16) 0,rgba(0,0,0,.08) 25%,rgba(0,0,0,.08) 75%,rgba(0,0,0,.16)),linear-gradient(90deg,hsla(0,0%,100%,.72) 0,hsla(0,0%,100%,.96) 25%,hsla(0,0%,100%,.96) 75%,hsla(0,0%,100%,.72)),url(/_nuxt/img/motion-background.f5d545e.gif)}input.nn-text-field,textarea.nn-text-field{display:inline-flex;margin:0;padding:4px 8px;height:40px;background:#f9f9ff;border:2px solid #ddd;border-radius:8px;font-size:16px;font-weight:400;color:#222;-webkit-appearance:textfield}input.nn-text-field:focus,textarea.nn-text-field:focus{border-color:#0095ee}input.nn-text-field.type-small,textarea.nn-text-field.type-small{font-size:14px;height:32px}.nn-toggle{display:inline-flex;cursor:pointer}.nn-toggle input[type=checkbox]{display:none}.nn-toggle input[type=checkbox]:not(:checked)+.nn-toggle-ui .nn-toggle-on-text{opacity:0}.nn-toggle input[type=checkbox]:not(:checked)+.nn-toggle-ui:before{transform:translateX(-16px)}.nn-toggle input[type=checkbox]:checked+.nn-toggle-ui .nn-toggle-off-text{opacity:0}.nn-toggle input[type=checkbox]:checked+.nn-toggle-ui:before{transform:translateX(16px)}.nn-toggle .nn-toggle-ui{position:relative;display:inline-flex;align-items:center;width:64px;height:32px;border:1px solid #ddd;border-radius:16px}.nn-toggle .nn-toggle-ui:before{content:"";position:absolute;left:0;right:0;margin:auto;width:28px;height:28px;border:1px solid #ddd;border-radius:14px;background:#fff;z-index:1;transition:transform .3s cubic-bezier(.22,.61,.36,1)}.nn-toggle .nn-toggle-ui span{position:absolute;display:inline-flex;justify-content:center;align-items:center;width:32px;height:100%;font-size:12px;line-height:1;font-weight:700;text-transform:uppercase;pointer-events:none;transition:opacity .3s cubic-bezier(.22,.61,.36,1)}.nn-toggle .nn-toggle-ui .nn-toggle-on-text{left:4px}.nn-toggle .nn-toggle-ui .nn-toggle-off-text{right:4px}.nn-checkbox{display:inline-flex;align-items:center}.nn-checkbox>input{display:inline-flex;margin:0;width:16px;height:16px;border:1px solid #ddd;border-radius:4px}.nn-checkbox>span{margin-left:2px}.nn-select{display:inline-flex;margin:0;padding:0 8px;height:40px;background:#f9f9ff;border:2px solid #ddd;border-radius:8px;font-size:16px;font-weight:400;color:#222}.nn-select:focus{border-color:#0095ee}label.nn-label{display:block;text-align:left;color:#666;font-size:14px;font-weight:700}label.nn-label+.nn-text-field{margin-top:8px}.nn-button,button{display:inline-flex;justify-content:center;align-items:center}.nn-button{padding:0 24px;min-height:40px;border:1px solid transparent;border-radius:20px;font-size:14px;font-weight:700;line-height:1;overflow:hidden;text-align:center;text-decoration:none;vertical-align:middle;white-space:nowrap;word-break:break-word;transition-property:background-color,border-color,color,fill;cursor:pointer;background:#ddd;color:#222}.nn-button:focus,.nn-button:hover{filter:brightness(1.1)}.nn-button:active{filter:brightness(.9)}.nn-button:disabled{cursor:default}.nn-button.type-large{min-height:48px;font-size:16px;border-radius:24px}.nn-button.type-small{min-height:40px;font-size:14px;border-radius:20px}.nn-button.type-xsmall{padding:0 16px;min-height:32px;font-size:14px;border-radius:16px}.nn-button.type-primary{background:#005bea;color:#fff}.nn-button.type-secondary{border:2px solid #005bea;color:#005bea;background:0 0}.nn-button.type-secondary:focus,.nn-button.type-secondary:hover{border:2px solid #338eff;color:#338eff}.nn-button.type-secondary:active{border:2px solid #0028b7;color:#0028b7}.nn-button.type-attention{background:#ff0211;color:#fff}.nn-button.type-attention:active,.nn-button.type-attention:focus,.nn-button.type-attention:hover{background:#ff3642;color:#fff}.nn-icon-button{display:inline-flex;padding:0;border:none;background:0 0;cursor:pointer}.nn-icon-button:hover svg{fill:#ddd}.nn-heading-1{font-weight:700;line-height:1}@media (max-width:959px){.nn-heading-1{font-size:20px}}@media (min-width:960px){.nn-heading-1{font-size:24px}}.nn-heading-2{font-weight:700;line-height:1}@media (max-width:959px){.nn-heading-2{font-size:20px}}@media (min-width:960px){.nn-heading-2{font-size:24px}}.nn-heading-subtext{margin-top:8px}.nn-list{margin:0;padding:0}.nn-list>li{margin:0;padding:4px 8px;border-top:1px solid #ddd}.nn-list>li:first-child{border-top:none}.nn-table-list{display:table}.nn-table-list>li{display:table-row}.nn-dlist{display:flex;flex-direction:column;margin:0;padding:0;width:100%}.nn-dlist>dt{margin:0;padding:8px 0 0;border-top:1px solid #ddd;line-height:1.5em;font-weight:700}.nn-dlist>dt:first-child{border-top:none}.nn-dlist>dd{margin:-1.5em 0 0 auto;padding:0 0 8px;line-height:1.5em}.nn-table{margin:0;padding:0;border-collapse:collapse;border-spacing:0}.nn-table thead td{font-weight:700}.nn-table tbody tr{border-top:1px solid #ddd}.nn-table tfoot tr,.nn-table thead tr{border-top:none}.nn-table td{margin:0 auto;padding:8px 16px}.nn-icon{display:inline-flex;width:24px;height:24px;fill:#222}.nn-icon.type-large{width:32px;height:32px}.nn-icon.type-small{width:20px;height:20px}.nn-icon.type-xsmall{width:16px;height:16px}.nn-icon.secondary{fill:#999}.nn-icon.disabled{fill:#ccc}.nn-icon.accent{fill:#0095ee}.nn-icon.attention{fill:#ff0211}.nn-icon.white{fill:#fff}.nn-icon.black{fill:#000}.nn-icon.inherit{fill:inherit}a.nn-link{text-decoration:none}a.nn-link::hover{text-decoration:underline}.nn-modal-content{padding:24px}.nn-dialog-content{padding:40px;width:100%}.nn-dialog-content .nn-dialog-title{font-size:20px}.nn-dialog-content .nn-dialog-text{margin-top:16px;font-size:14px;color:#666}.nn-dialog-content .nn-dialog-button-group{margin:32px auto auto;display:flex;justify-content:space-around;align-items:center}article{font-family:Quicksand,"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;color:#333}article .nuxt-content{margin-top:64px}article h1{margin-top:48px;font-size:28px}article h2{margin-top:48px;font-size:24px}article h3{margin-top:48px;font-size:18px}article h4,article h5,article h6{margin-top:48px;font-size:14px}article ul{margin-top:40px;padding-left:16px}article ul li{line-height:32px;font-size:16px}article ul li>ul{margin-top:0}article p{margin:16px 0 0;font-size:16px;line-height:32px}article a{color:#444}article a:hover{color:#555}article .nuxt-content-highlight{margin-top:16px}article iframe,article pre{border:1px solid #efefef;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.32)}article iframe{display:block;margin:auto}code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono,monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#363636}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#363636}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#c3e88d}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name,.token.color{color:#f2ff00}.token.comment{color:#546e7a}.token.constant{color:#c792ea}.token.deleted{color:#f07178}.token.doctype{color:#546e7a}.token.entity{color:#f07178}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea;font-style:italic}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#546e7a}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#c3e88d}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f07178}.token.string{color:#c3e88d}.token.symbol{color:#c792ea}.token.tag,.token.unit{color:#f07178}.token.url{color:#fd9170}.token.variable{color:#f07178}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.button--green{display:inline-block;border-radius:4px;border:1px solid #3b8070;color:#3b8070;text-decoration:none;padding:10px 30px}.button--green:hover{color:#fff;background-color:#3b8070}.button--grey{display:inline-block;border-radius:4px;border:1px solid #35495e;color:#35495e;text-decoration:none;padding:10px 30px;margin-left:15px}.button--grey:hover{color:#fff;background-color:#35495e}header[data-v-4bd01cdf]{width:640px;margin:0 auto;padding:32px 0 0}nav[data-v-4bd01cdf]{display:flex;align-items:center;justify-content:space-around}nav .link[data-v-4bd01cdf]{display:inline;font-size:16px;font-weight:700;text-transform:uppercase;text-decoration:none;color:#444}nav .link[data-v-4bd01cdf]:hover{text-decoration:underline;color:#555}nav .image[data-v-4bd01cdf]{display:inline-flex;width:72px;height:72px;border:1px solid #efefef;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.24)}nav .source[data-v-4bd01cdf]{width:100%;height:100%}.title-group[data-v-4bd01cdf]{margin-top:40px;display:flex}.title-group h1[data-v-4bd01cdf]{font-size:24px;font-weight:700;color:#444}article[data-v-d83be920]{margin-top:64px}.body[data-v-d83be920]{margin-top:40px}.container[data-v-18bccaa8]{width:640px;margin:auto}@media (max-width:959px){.container[data-v-18bccaa8]{width:100%;padding:16px}}footer[data-v-3a194372]{width:100%;height:120px;margin:64px 0 0;border-top:2px solid hsla(0,0%,100%,.48)}nav[data-v-3a194372]{display:flex;align-items:center;justify-content:space-around}nav .link[data-v-3a194372]{display:inline;font-size:16px;font-weight:700;text-transform:uppercase;text-decoration:none;color:#444}nav .link[data-v-3a194372]:hover{text-decoration:underline;color:#555}nav .image[data-v-3a194372]{display:inline-flex;width:72px;height:72px;border:1px solid #efefef;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.24)}nav .source[data-v-3a194372]{width:100%;height:100%}.title-group[data-v-3a194372]{margin-top:40px;display:flex}.title-group h1[data-v-3a194372]{font-size:24px;font-weight:700;color:#444}</style><link rel="preload" href="/_nuxt/static/1609838232/articles/2021-01-04-custom-elements-form-issue/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1609838232/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><header data-v-4bd01cdf><nav data-v-4bd01cdf><a href="https://nekobato.net" class="link" data-v-4bd01cdf>About me</a> <picture class="image" data-v-4bd01cdf><img src="/_nuxt/img/logo.d866ef5.png" alt="ロゴ" class="source" data-v-4bd01cdf></picture> <a href="/" class="link" data-v-4bd01cdf>LOG</a></nav> <div class="title-group" data-v-4bd01cdf><h1 data-v-4bd01cdf>nekobatoken</h1></div></header> <div class="container" data-v-18bccaa8 data-v-d83be920><article data-v-18bccaa8 data-v-d83be920><h1 data-v-18bccaa8 data-v-d83be920>Web ComponentsでInputを扱う方法</h1> <div class="body nuxt-content" data-v-18bccaa8 data-v-d83be920><h2 id="問題" data-v-18bccaa8 data-v-d83be920><a href="#%E5%95%8F%E9%A1%8C" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>問題</h2>
<p data-v-18bccaa8 data-v-d83be920>Custom Elements(Web Components)の中で<code data-v-18bccaa8 data-v-d83be920>input</code>を使うと色々問題がある</p>

<h3 id="1-buttonを押しても-submit-が動かない" data-v-18bccaa8 data-v-d83be920><a href="#1-button%E3%82%92%E6%8A%BC%E3%81%97%E3%81%A6%E3%82%82-submit-%E3%81%8C%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>1. <code data-v-18bccaa8 data-v-d83be920>button</code>を押しても submit が動かない</h3>
<p data-v-18bccaa8 data-v-d83be920>例えばこのような form があった時、この<code data-v-18bccaa8 data-v-d83be920>button</code>を押しても form の submit は発火しない。</p>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-html" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  ...
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>button-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
    #shadow-dom
    <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>button</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>type</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>submit<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>Submit<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>button</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>button-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
</code></pre></div>
<p data-v-18bccaa8 data-v-d83be920>submit の動作は別 DOM Tree、この場合 Shadow DOM から見て Light DOM の Tree にある form に到達しない。</p>
<h3 id="2-外部のinputと連携してくれない" data-v-18bccaa8 data-v-d83be920><a href="#%08%082-%E5%A4%96%E9%83%A8%E3%81%AEinput%E3%81%A8%E9%80%A3%E6%90%BA%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>2. 外部の<code data-v-18bccaa8 data-v-d83be920>input</code>と連携してくれない</h3>
<p data-v-18bccaa8 data-v-d83be920>これが特に問題になるのは主に<code data-v-18bccaa8 data-v-d83be920>autocomplete</code>を使用したい時で、他の input と<code data-v-18bccaa8 data-v-d83be920>autocomplete</code>の挙動を連携してくれなくなってしまう。</p>
<p data-v-18bccaa8 data-v-d83be920><a href="https://developer.mozilla.org/ja/docs/Web/HTML/Attributes/autocomplete" rel="nofollow noopener noreferrer" target="_blank" data-v-18bccaa8 data-v-d83be920>https://developer.mozilla.org/ja/docs/Web/HTML/Attributes/autocomplete</a></p>
<p data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920>autocomplete</code>は例えばこのような input を作った場合、１つ目に名前を入力する（しようとする）と２つ目にも入力候補が出現する。</p>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-html" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>input</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>autocomplete</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>given-name<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>/></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>input</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>autocomplete</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>family-name<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>/></span></span>
<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
</code></pre></div>
<p data-v-18bccaa8 data-v-d83be920>住所とかも然り。</p>
<p data-v-18bccaa8 data-v-d83be920>Custom Elements で input の wrapper component を作ると、それぞれ別の DOM Tree であるからか、 入力候補は連携してくれない。</p>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-html" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>text-field-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
    #shadow-dom
    <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>input</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>autocomplete</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>given-name<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>/></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>text-field-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>text-field-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
    #shadow-dom
    <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>input</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>autocomplete</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>family-name<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>/></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>text-field-component</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>form</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
</code></pre></div>
<h3 id="3-formの-submit-では-shadow-dom-内の-input-value-を拾ってくれない" data-v-18bccaa8 data-v-d83be920><a href="#3-form%E3%81%AE-submit-%E3%81%A7%E3%81%AF-shadow-dom-%E5%86%85%E3%81%AE-input-value-%E3%82%92%E6%8B%BE%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>3. <code data-v-18bccaa8 data-v-d83be920>form</code>の submit では Shadow DOM 内の input value を拾ってくれない</h3>
<p data-v-18bccaa8 data-v-d83be920>上述のものと同じく、別 Tree の input value は検出してくれない。</p>
<h2 id="解決策" data-v-18bccaa8 data-v-d83be920><a href="#%E8%A7%A3%E6%B1%BA%E7%AD%96" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>解決策</h2>
<p data-v-18bccaa8 data-v-d83be920>以上の問題点。全てはそれぞれ連携ができるはずの Element が Light DOM と Shadow DOM に分かれたことで、これを解決すればなんとかなりそう。</p>
<p data-v-18bccaa8 data-v-d83be920>解決法は主に 3 つある。もっとあったらおしえてください。</p>
<h3 id="1-shadown-dom-ではなく-light-dom-に表示する" data-v-18bccaa8 data-v-d83be920><a href="#1-shadown-dom-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F-light-dom-%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>1. Shadown DOM ではなく Light DOM に表示する</h3>
<p data-v-18bccaa8 data-v-d83be920>Custom Element の中身を Light DOM に表示するようにすることで、単純に他の Element から影響を受けられるようにする。
もちろん Shadow DOM ではないので隠蔽はされず、他からの改変が容易になる。</p>
<p data-v-18bccaa8 data-v-d83be920>例えば Lit Element だと<code data-v-18bccaa8 data-v-d83be920>createRenderRoot</code>内で<code data-v-18bccaa8 data-v-d83be920>this</code>を返すことで Light DOM への表示に切り替わります。</p>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-js" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token keyword" data-v-18bccaa8 data-v-d83be920>class</span> <span class="token class-name" data-v-18bccaa8 data-v-d83be920>LightDom</span> <span class="token keyword" data-v-18bccaa8 data-v-d83be920>extends</span> <span class="token class-name" data-v-18bccaa8 data-v-d83be920>LitElement</span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>{</span>
  <span class="token function" data-v-18bccaa8 data-v-d83be920>render</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>(</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>)</span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>{</span>
    <span class="token keyword control-flow" data-v-18bccaa8 data-v-d83be920>return</span> html<span class="token template-string" data-v-18bccaa8 data-v-d83be920><span class="token template-punctuation string" data-v-18bccaa8 data-v-d83be920>`</span><span class="token html language-html" data-v-18bccaa8 data-v-d83be920> <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>p</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>This template renders without shadow DOM.<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>p</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span> </span><span class="token template-punctuation string" data-v-18bccaa8 data-v-d83be920>`</span></span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>;</span>
  <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>}</span>
  <span class="token function" data-v-18bccaa8 data-v-d83be920>createRenderRoot</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>(</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>)</span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>{</span>
    <span class="token doc-comment comment" data-v-18bccaa8 data-v-d83be920>/**
     * Render template without shadow DOM. Note that shadow DOM features like
     * encapsulated CSS and slots are unavailable.
     */</span>
    <span class="token keyword control-flow" data-v-18bccaa8 data-v-d83be920>return</span> <span class="token keyword" data-v-18bccaa8 data-v-d83be920>this</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>;</span>
  <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>}</span>
<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>}</span>
</code></pre></div>
<p data-v-18bccaa8 data-v-d83be920><a href="https://lit-element.polymer-project.org/guide/templates#renderroot" rel="nofollow noopener noreferrer" target="_blank" data-v-18bccaa8 data-v-d83be920>https://lit-element.polymer-project.org/guide/templates#renderroot</a></p>
<p data-v-18bccaa8 data-v-d83be920>注意点としては、Light DOM での表示を指定すると<code data-v-18bccaa8 data-v-d83be920>&lt;slot></code>が使えなくなる。それ以上の柔軟なコンテンツ変更は attribute を使うしかないということになる。</p>
<h3 id="2-input-はコンポーネントに含めず、コンポーネントは-input-の-wrapper-とする" data-v-18bccaa8 data-v-d83be920><a href="#2-input-%E3%81%AF%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AB%E5%90%AB%E3%82%81%E3%81%9A%E3%80%81%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AF-input-%E3%81%AE-wrapper-%E3%81%A8%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>2. input はコンポーネントに含めず、コンポーネントは input の wrapper とする</h3>
<p data-v-18bccaa8 data-v-d83be920>このように</p>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-js" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token keyword control-flow" data-v-18bccaa8 data-v-d83be920>return</span> html<span class="token template-string" data-v-18bccaa8 data-v-d83be920><span class="token template-punctuation string" data-v-18bccaa8 data-v-d83be920>`</span><span class="token html language-html" data-v-18bccaa8 data-v-d83be920>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>div</span> <span class="token attr-name" data-v-18bccaa8 data-v-d83be920>class</span><span class="token attr-value" data-v-18bccaa8 data-v-d83be920><span class="token punctuation attr-equals" data-v-18bccaa8 data-v-d83be920>=</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span>input-decorator<span class="token punctuation" data-v-18bccaa8 data-v-d83be920>"</span></span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
    <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>slot</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>slot</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>div</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
</span><span class="token template-punctuation string" data-v-18bccaa8 data-v-d83be920>`</span></span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>;</span>
</code></pre></div>
<div class="nuxt-content-highlight" data-v-18bccaa8 data-v-d83be920><pre class="line-numbers language-html" data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>text-field-container</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
  <span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;</span>input</span> <span class="token punctuation" data-v-18bccaa8 data-v-d83be920>/></span></span>
<span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token tag" data-v-18bccaa8 data-v-d83be920><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>&lt;/</span>text-field-container</span><span class="token punctuation" data-v-18bccaa8 data-v-d83be920>></span></span>
</code></pre></div>
<p data-v-18bccaa8 data-v-d83be920>スタイルなどは Custom Element が受け持つが、実際の input Element は Light DOM に置く。
この方法だと input タグのスタイリングなどは可能だが、input の値をバキバキに改変する機能などを実装するのは大変面倒になる。というかそういった機能はこの場合あまり現実的ではないと思う。
その上、input は外部から簡単にアクセス可能な場所に置くことになるため、Custom Element としてコンポーネントに縛りを持たせるのは難しい。</p>
<p data-v-18bccaa8 data-v-d83be920>「input には何も css も attributes も付けないでね！」などの注意書きが必要になる。</p>
<h3 id="3-autocomplete-連携を諦めて、挙動を自前で作る" data-v-18bccaa8 data-v-d83be920><a href="#3-autocomplete-%E9%80%A3%E6%90%BA%E3%82%92%E8%AB%A6%E3%82%81%E3%81%A6%E3%80%81%E6%8C%99%E5%8B%95%E3%82%92%E8%87%AA%E5%89%8D%E3%81%A7%E4%BD%9C%E3%82%8B" aria-hidden="true" tabindex="-1" data-v-18bccaa8 data-v-d83be920><span class="icon icon-link" data-v-18bccaa8 data-v-d83be920></span></a>3. autocomplete 連携を諦めて、挙動を自前で作る</h3>
<p data-v-18bccaa8 data-v-d83be920>もしくは、どうせフレームワーク使うでしょという方針でネイティブ挙動は何もサポートしない。</p>
<p data-v-18bccaa8 data-v-d83be920>これは便利な機能が一つ減るわけなのであまりおすすめできませんが、submit や button の挙動は自前でなんとかなります。</p>
<p data-v-18bccaa8 data-v-d83be920>Spectrum はこの点について考慮漏れかもしくは同じく諦めてるっぽい？</p>
<p data-v-18bccaa8 data-v-d83be920><a href="https://opensource.adobe.com/spectrum-web-components/components/textfield" rel="nofollow noopener noreferrer" target="_blank" data-v-18bccaa8 data-v-d83be920>https://opensource.adobe.com/spectrum-web-components/components/textfield</a></p>
<p data-v-18bccaa8 data-v-d83be920>自前実装の方法は<code data-v-18bccaa8 data-v-d83be920>button</code>をクリックしたら周辺の form を探して submit を発火させたりとか地道にネイティブ挙動を再実装する必要がありそう。アクセシビリティも忘れずに。</p>
<p data-v-18bccaa8 data-v-d83be920><code data-v-18bccaa8 data-v-d83be920>formData</code>は polyfill を使えば Safari も使えそう。</p>
<p data-v-18bccaa8 data-v-d83be920><a href="https://developer.mozilla.org/ja/docs/Web/API/FormData" rel="nofollow noopener noreferrer" target="_blank" data-v-18bccaa8 data-v-d83be920>https://developer.mozilla.org/ja/docs/Web/API/FormData</a>
<a href="https://github.com/jimmywarting/FormData" rel="nofollow noopener noreferrer" target="_blank" data-v-18bccaa8 data-v-d83be920>https://github.com/jimmywarting/FormData</a></p></div></article></div> <footer data-v-3a194372></footer></div></div></div><script>window.__NUXT__={staticAssetsBase:"/_nuxt/static/1609838232",layout:"default",error:null,serverRendered:!0,routePath:"/articles/2021-01-04-custom-elements-form-issue",config:{content:{dbHash:"115d8119"}}}</script><script src="/_nuxt/ecea5ae.js" defer></script><script src="/_nuxt/c3ba0e7.js" defer></script><script src="/_nuxt/95985e6.js" defer></script><script src="/_nuxt/8645003.js" defer></script><script src="/_nuxt/8bb19f3.js" defer></script>
  </body>
</html>
